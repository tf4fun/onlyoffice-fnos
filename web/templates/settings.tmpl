<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OnlyOffice Connector 设置</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="/static/htmx.min.js"></script>
</head>
<body style="padding: 20px;">
    <div class="container">
        <h1>OnlyOffice Connector 设置</h1>
        
        <form hx-post="/api/settings" hx-target="#message" hx-swap="innerHTML">
            <div class="form-group">
                <label for="documentServerUrl">Document Server 地址</label>
                <div class="input-row">
                    <input type="url" id="documentServerUrl" name="documentServerUrl" class="input-field" 
                           placeholder="http://192.168.1.100:8080" value="{{.Settings.DocumentServerURL}}" required>
                    <button type="button" class="btn btn-secondary"
                            hx-post="/api/settings/validate"
                            hx-include="#documentServerUrl"
                            hx-target="#status"
                            hx-swap="innerHTML">
                        测试连接
                    </button>
                </div>
                <div class="help-text">输入 OnlyOffice Document Server 的完整地址</div>
                <div id="status"></div>
            </div>

            <div class="form-group">
                <label for="secret">JWT 密钥</label>
                <div class="input-row">
                    <input type="text" id="secret" name="documentServerSecret" class="input-field"
                           placeholder="输入或生成 JWT 密钥" value="{{.Settings.DocumentServerSecret}}">
                    <button type="button" class="btn btn-secondary"
                            hx-post="/api/settings/generate-key"
                            hx-target="#secret"
                            hx-swap="outerHTML">
                        重新生成
                    </button>
                </div>
                <div class="help-text">用于与 Document Server 安全通信的密钥，需与 Document Server 配置一致</div>
            </div>

            <div class="form-group">
                <label for="baseUrl">本机回调地址</label>
                <div class="input-row">
                    <input type="url" id="baseUrl" name="baseUrl" class="input-field" 
                           placeholder="http://192.168.1.100:10099" value="{{.Settings.BaseURL}}" required>
                </div>
                <div class="help-text">Document Server 回调本服务的地址，需填写 NAS 的内网 IP（Docker 中的 Document Server 无法访问 localhost）</div>
            </div>

            <button type="submit" class="btn btn-primary btn-block">保存设置</button>
            <div id="message" class="mt-10"></div>
        </form>
    </div>
</body>
</html>
